# SQLアンチパターン

## （DB論理設計編）
1. カンマ区切りフォーマットのリストを格納していないか？
2. 3世代以上の階層があるデータ構造を扱う場合に、直接の親子関係のみを参照する形にしていないか？
3. 主キー名を何も考えず `id` にしていないか？
4. 必要な外部キーは設定しているか？
5. 柔軟に「列」を増やすために、Attribute とその Value を表す列を作成してしまっていないか？
6. 複数の異なるテーブルに紐付く可能性があるテーブルを作成する場合に、xx_type といった列を見て紐付く先のテーブルを判断する設計になっていないか？
7. 1対Nで保持したいデータがある場合に、列を row1、row2、、、rowN のように増殖させる設計にしていないか？
8. 時間経過によってテーブルや列を増やすことを前提とした設計になっていないか？

## （SQLクエリ設計編）
1. NULLを一般値として使用していないか？一般値をNULLに相当するものとして扱っていないか？
2. GROUP BY句を使う場合、単一値の原則を満たすクエリとなっているか
3. ランダムにレコードを取得する場合、性能劣化しない方式を採用できているか
4. データ量が増える可能性のあるテーブルに、あいまい検索していないか
5. 複雑すぎるクエリを作っていないか
6. 必要のない列まで SELECT していないか

## （SQLクエリ設計編）
1. NULLを一般値として使用していないか？一般値をNULLに相当するものとして扱っていないか？
2. GROUP BY句を使う場合、単一値の原則を満たすクエリとなっているか
3. ランダムにレコードを取得する場合、性能劣化しない方式を採用できているか
4. データ量が増える可能性のあるテーブルに、あいまい検索していないか
5. 複雑すぎるクエリを作っていないか
6. 必要のない列まで SELECT していないか

## （アプリケーション設計編）
1. パスワードを平文でテーブルに格納していないか
2. 動的に SQL 文を作成するときに SQL インジェクションへの対策をしているか
3. 連番主キーの欠番を頑張って埋めようとしていないか
4. DB接続している部分で例外処理しないプログラムはないか
5. バージョン管理されてない DB 関連リソースはないか
6. モデルがアクティブレコード化していないか
7. 発生しうる問題やそれに対する対応はまとまっているか

### 参考
- [書籍：SQLアンチパターン](https://www.amazon.co.jp/exec/obidos/ASIN/4873115892/hatena-blog-22/)

- [「SQLアンチパターン」を避けるためのチェックリスト①（DB論理設計編](https://www.ketancho.net/entry/2018/03/07/080000)
- [「SQLアンチパターン」を避けるためのチェックリスト②（DB物理設計編）](https://www.ketancho.net/entry/2018/03/09/080000)
- [「SQLアンチパターン」を避けるためのチェックリスト③（SQLクエリ設計編）](https://www.ketancho.net/entry/2018/03/14/074500)
- [「SQLアンチパターン」を避けるためのチェックリスト④（アプリケーション設計編）](https://www.ketancho.net/entry/2018/04/24/083000)
- [幻の26章](https://www.slideshare.net/t_wada/ronsakucasual)
